{% extends "layout.html" %}

{% block title %}Thao tác{% endblock %}

{% block nav_items %}
<li class="nav-item">
    <a class="nav-link p-2" href="/">Hộp chat</a>
</li>
<li class="nav-item">
    <a class="nav-link p-2 active" href="/introduction">Giới thiệu</a>
</li>
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4">Điều khiển đèn</h1>
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title">Điều khiển đèn</h5>
                    <div id="led1-status" class="led-indicator">Đèn 1: Đang tải...</div>
                    <div id="led2-status" class="led-indicator">Đèn 2: Đang tải...</div>
                    <br>
                    <button class="btn btn-primary m-2" onclick="toggleLed(1)">Tắt/Mở đèn 1</button>
                    <button class="btn btn-primary m-2" onclick="toggleLed(2)">Tắt/Mở đèn 2</button>
                    <br>
                    <button class="btn btn-success m-2" onclick="controlAll('on')">Mở tất cả đèn</button>
                    <button class="btn btn-danger m-2" onclick="controlAll('off')">Tắt tất cả đèn</button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.led-indicator {
    padding: 10px;
    margin: 5px;
    border-radius: 5px;
    font-weight: bold;
    color: white;
}
.led-indicator.on {
    background-color: green;
}
.led-indicator.off {
    background-color: red;
}
.led-indicator.unknown {
    background-color: gray;
}
</style>

<script>
function updateStatus() {
    fetch('/get_status')
        .then(response => response.json())
        .then(data => {
            document.getElementById('led1-status').textContent = `Đèn 1: ${data.led1}`;
            document.getElementById('led1-status').className = `led-indicator ${data.led1.toLowerCase()}`;
            document.getElementById('led2-status').textContent = `Đèn 2: ${data.led2}`;
            document.getElementById('led2-status').className = `led-indicator ${data.led2.toLowerCase()}`;
        })
        .catch(error => console.error('Error fetching status:', error));
}

function toggleLed(led) {
    fetch(`/toggle_led${led}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            updateStatus();  // Update status after toggle
        })
        .catch(error => console.error('Error:', error));
}

function controlAll(action) {
    fetch(`/control_all?action=${action}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
            updateStatus();  // Update status after control
        })
        .catch(error => console.error('Error:', error));
}

// Load status on page load
window.onload = updateStatus;
</script>
{% endblock %}